<div class="evaluation-detail-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement de l'√©valuation...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <span class="alert-icon">‚ö†Ô∏è</span>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <span class="alert-icon">‚úÖ</span>
    <p>{{ successMessage }}</p>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && evaluation" class="content">
    <!-- Header -->
    <header class="page-header">
      <div class="header-content">
        <div>
          <h1 class="page-title">D√©tails de l'√©valuation</h1>
          <p class="page-subtitle">
            {{ application?.firstName }} {{ application?.lastName }} - √âvalu√©e le {{ formatDate(evaluation.createdAt) }}
          </p>
        </div>
        <div class="header-actions">
          <button class="btn-back" (click)="goBack()">
            ‚Üê Retour
          </button>
        </div>
      </div>
    </header>

    <div class="detail-layout">
      <!-- Left Panel - Evaluation Details -->
      <div class="evaluation-panel">
        <!-- Score Summary Card -->
        <div class="score-summary-card">
          <div class="summary-header">
            <h2 class="summary-title">üìä R√©sum√© des scores</h2>
            <div class="total-badge" [ngClass]="getTotalScoreClass()">
              {{ getTotalScore() }}/100
            </div>
          </div>

          <div class="scores-grid">
            <div class="score-item">
              <div class="score-label">
                <span class="score-icon">üéì</span>
                <span>Dipl√¥me</span>
              </div>
              <div class="score-bar-container">
                <div class="score-bar" *ngIf="evaluation.diplomaScore" [style.width.%]="(evaluation.diplomaScore / 20) * 100"></div>
              </div>
              <span class="score-value">{{ evaluation.diplomaScore }}/20</span>
            </div>

            <div class="score-item">
              <div class="score-label">
                <span class="score-icon">üíº</span>
                <span>Exp√©rience</span>
              </div>
              <div class="score-bar-container">
                <div class="score-bar" *ngIf="evaluation.experienceScore" [style.width.%]="(evaluation.experienceScore / 20) * 100"></div>
              </div>
              <span class="score-value">{{ evaluation.experienceScore }}/20</span>
            </div>

            <div class="score-item">
              <div class="score-label">
                <span class="score-icon">üîß</span>
                <span>Comp√©tences</span>
              </div>
              <div class="score-bar-container">
                <div class="score-bar" *ngIf="evaluation.competenceScore" [style.width.%]="(evaluation.competenceScore / 20) * 100"></div>
              </div>
              <span class="score-value">{{ evaluation.competenceScore }}/20</span>
            </div>

            <div class="score-item">
              <div class="score-label">
                <span class="score-icon">üéØ</span>
                <span>Motivation</span>
              </div>
              <div class="score-bar-container">
                <div class="score-bar" *ngIf="evaluation.motivationScore" [style.width.%]="(evaluation.motivationScore / 20) * 100"></div>
              </div>
              <span class="score-value">{{ evaluation.motivationScore }}/20</span>
            </div>

            <div class="score-item">
              <div class="score-label">
                <span class="score-icon">ü§ù</span>
                <span>Soft Skills</span>
              </div>
              <div class="score-bar-container">
                <div class="score-bar" *ngIf="evaluation.softSkillsScore" [style.width.%]="(evaluation.softSkillsScore / 20) * 100"></div>
              </div>
              <span class="score-value">{{ evaluation.softSkillsScore }}/20</span>
            </div>
          </div>
        </div>

        <!-- Comment Card -->
        <div class="comment-card" *ngIf="evaluation.comment">
          <h3 class="comment-title">üí¨ Commentaire</h3>
          <p class="comment-text">{{ evaluation.comment }}</p>
        </div>

        <div class="comment-card empty" *ngIf="!evaluation.comment">
          <h3 class="comment-title">üí¨ Commentaire</h3>
          <p class="empty-comment">Aucun commentaire ajout√©</p>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="isEditMode" class="edit-card">
          <h3 class="edit-title">‚úèÔ∏è Modifier l'√©valuation</h3>

          <form class="edit-form" (ngSubmit)="saveEdit()">
            <div class="score-section">
              <div class="form-group">
                <label for="diplomaScore" class="form-label">
                  Score Dipl√¥me
                  <span class="score-indicator">{{ editData.diplomaScore }}/20</span>
                </label>
                <input
                  type="range"
                  id="diplomaScore"
                  class="form-range"
                  [(ngModel)]="editData.diplomaScore"
                  name="diplomaScore"
                  min="0"
                  max="20"
                  step="0.5"
                />
              </div>

              <div class="form-group">
                <label for="experienceScore" class="form-label">
                  Score Exp√©rience
                  <span class="score-indicator">{{ editData.experienceScore }}/20</span>
                </label>
                <input
                  type="range"
                  id="experienceScore"
                  class="form-range"
                  [(ngModel)]="editData.experienceScore"
                  name="experienceScore"
                  min="0"
                  max="20"
                  step="0.5"
                />
              </div>

              <div class="form-group">
                <label for="competenceScore" class="form-label">
                  Score Comp√©tences
                  <span class="score-indicator">{{ editData.competenceScore }}/20</span>
                </label>
                <input
                  type="range"
                  id="competenceScore"
                  class="form-range"
                  [(ngModel)]="editData.competenceScore"
                  name="competenceScore"
                  min="0"
                  max="20"
                  step="0.5"
                />
              </div>

              <div class="form-group">
                <label for="motivationScore" class="form-label">
                  Score Motivation
                  <span class="score-indicator">{{ editData.motivationScore }}/20</span>
                </label>
                <input
                  type="range"
                  id="motivationScore"
                  class="form-range"
                  [(ngModel)]="editData.motivationScore"
                  name="motivationScore"
                  min="0"
                  max="20"
                  step="0.5"
                />
              </div>

              <div class="form-group">
                <label for="softSkillsScore" class="form-label">
                  Score Soft Skills
                  <span class="score-indicator">{{ editData.softSkillsScore }}/20</span>
                </label>
                <input
                  type="range"
                  id="softSkillsScore"
                  class="form-range"
                  [(ngModel)]="editData.softSkillsScore"
                  name="softSkillsScore"
                  min="0"
                  max="20"
                  step="0.5"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="comment" class="form-label">Commentaire</label>
              <textarea
                id="comment"
                class="form-textarea"
                [(ngModel)]="editData.comment"
                name="comment"
                rows="5"
                placeholder="Ajoutez ou modifiez votre commentaire..."
              ></textarea>
            </div>

            <div class="edit-actions">
              <button type="button" class="btn-secondary" (click)="cancelEdit()">
                Annuler
              </button>
              <button type="submit" class="btn-primary" [disabled]="isUpdating">
                <span *ngIf="!isUpdating">Enregistrer</span>
                <span *ngIf="isUpdating" class="loading-text">
                  <span class="spinner-small"></span>
                  Mise √† jour...
                </span>
              </button>
            </div>
          </form>
        </div>

        <!-- Actions (when not in edit mode) -->
        <div *ngIf="!isEditMode" class="action-buttons">
          <button class="btn-edit" (click)="enableEditMode()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Modifier l'√©valuation
          </button>
          <button class="btn-delete" (click)="deleteEvaluation()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
            Supprimer l'√©valuation
          </button>
        </div>
      </div>

      <!-- Right Panel - Candidate Info -->
      <div class="info-panel">
        <div class="info-card">
          <h3 class="info-title">üë§ Informations du candidat</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Nom</span>
              <span class="info-value">{{ application?.firstName }} {{ application?.lastName }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Email</span>
              <span class="info-value">{{ application?.email }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Offre</span>
              <span class="info-value">{{ application?.jobTitle }}</span>
            </div>
          </div>
        </div>

        <div class="info-card">
          <h3 class="info-title">üìù Informations de l'√©valuation</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">√âvaluateur</span>
              <span class="info-value">{{ evaluation.evaluatorName }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Date</span>
              <span class="info-value">{{ formatDate(evaluation.createdAt) }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Commission</span>
              <span class="info-value">Commission #{{ commissionId }}</span>
            </div>
          </div>
        </div>

        <!-- CV Viewer -->
        <div class="cv-card">
          <div class="cv-header">
            <h3 class="cv-title">üìÑ Curriculum Vitae</h3>
            <button *ngIf="cvUrl" class="btn-download-small" (click)="downloadCV()">
              ‚¨á T√©l√©charger
            </button>
          </div>

          <div class="cv-viewer-small">
            <div *ngIf="isLoadingCV" class="cv-loading">
              <div class="spinner-small"></div>
              <p>Chargement...</p>
            </div>

            <iframe
              *ngIf="!isLoadingCV && cvUrl"
              [src]="cvUrl"
              class="cv-iframe-small"
              title="CV du candidat"
            ></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
